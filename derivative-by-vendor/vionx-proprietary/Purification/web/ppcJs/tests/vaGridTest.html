<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>LogControl test</title>
    <link rel="stylesheet" type="text/css" href="../../dojo-toolkit/dojo/resources/dojo.css" />
    <link rel="stylesheet" type="text/css" href="../../dojo-toolkit/dijit/themes/soria/soria.css" />
    <link rel="stylesheet" type="text/css" href="../../dojo-toolkit/dojox/grid/resources/Grid.css" />
    <link rel="stylesheet" type="text/css" href="../../dojo-toolkit/dojox/grid/resources/soriaGrid.css" />
    <style type="text/css">
		.grid {
			width: 70em;
			height: 15em;
		}
	</style>

    <script type="text/javascript">
        // djConfig must be set before any dojo scripts are loaded
        var djConfig = {
            isDebug: false,
            parseOnLoad: true,
            modulePaths: { 'ppcJs': '../../ppcJs' }
        };
    </script>

    <script type="text/javascript" src="../../dojo-toolkit/dojo/dojo.js"></script>
    <script type="text/javascript">
        dojo.provide("ppcJs.tests.vaGridTestHTML");
        dojo.require("dojo.parser");
        dojo.require("doh.runner");
        dojo.require("dojo.robot");

        dojo.require('dojo.data.ItemFileWriteStore');
        dojo.require('dojox.data.XmlStore');
        dojo.require("dojox.grid.TreeGrid");
        dojo.require("dojox.grid.DataGrid");

        function summaryFormatter(value, rowIdx, cell, sing, plur) {
            var str;
            if (rowIdx >= 0) {
                return value;
            }
            if (rowIdx == -1) {
                str = "Total (${numItems} ${displayName}):";
            } else {
                str = "${numItems} ${displayName}";
            }
            return dojo.string.substitute(str, { numItems: value,
                displayName: (value == 1) ? sing : plur
            });
        }
        function quarterSummary(value, rowIdx) {
            return summaryFormatter(value, rowIdx, this, "Quarter", "Quarters");
        }

        dojo.addOnLoad(function () {
            doh.register("ppcJs.tests.vaGridTest", [
                    function testCreateVaGrid(t) {
                        var container = dojo.create('div');

                        var testUrl = 'vaeGridDataResponse.xml';
                        var xmlStore = new dojox.data.XmlStore({ url: testUrl, rootItem: 'item', label: 'label' });

                        // set the layout structure:
                        var gridStruct = [
					        { cells: [
						        [ /* item */
							        {field: 'label', name: 'Name' },
                                    { field: 'phase',
                                        children: [
									        { field: 'label', name: 'Phase' },
									        { field: 'val', name: 'Value' },
								        ],
                                        itemAggregates: ['', 'avg'],
                                        aggregate: 'sum'
                                    }
						        ]]
					        }
				        ];

                        var sut = new dojox.grid.TreeGrid({
                            structure: gridStruct,
                            store: xmlStore,
                            query: { type:'va'},
                            queryOptions: { deep: false },
                            rowSelector: true
                        }, container);
                        dojo.addClass(sut.domNode, "grid");
                        dojo.byId('sutContainer').appendChild(sut.domNode);
                        sut.startup();

                        t.assertTrue(true);
                    },

                    function testCreateEnergyGrid(t) {
                        var container = dojo.create('div');

                        var testUrl = 'vaeGridDataResponse.xml';
                        var xmlStore = new dojox.data.XmlStore({ url: testUrl, rootItem: 'item', label: 'label' });

                        // set the layout structure:
                        var gridStruct = [
					        { cells: [
						        [ /* item */
							        {field: 'label', name: 'Name' },
									{ field: 'yd', name: 'Yesterday' },
									{ field: 'td', name: 'Today' },
                                    { field: 'lm', name: 'Last Month' },
									{ field: 'tm', name: 'This Month' }
						        ]]
					        }
				        ];

                        var sut = new dojox.grid.DataGrid({
                            structure: gridStruct,
                            store: xmlStore,
                            query: { type: 'energy' },
                            queryOptions: { deep: false }
                        }, container);
                        dojo.addClass(sut.domNode, "grid");
                        dojo.byId('sutContainer').appendChild(sut.domNode);
                        sut.startup();

                        t.assertTrue(true);
                    },

                    function testTreeGrid(t) {
                        var container = dojo.create('div');

                        var testUrl = 'gridTest.xml';
                        var store = new dojox.data.XmlStore({ url: testUrl, rootItem: 'rootElement', label: 'label' });
                        //var testUrl = 'gamedata.json';
                        //var store = new dojo.data.ItemFileWriteStore({ url: testUrl });
                        var g = new dojox.grid.TreeGrid({
                            structure: [
					            { cells: [
						            [
							            { field: "label", name: "Game" },
							            { field: "qtrs",
							                children: [
									            { field: "label", name: "Quarter", width: "12em", formatter: quarterSummary },
									            { field: "pts", name: "Points" },
									            { field: "reb", name: "Rebounds" },
									            { field: "ast", name: "Assists" },
									            { field: "tp", name: "Time Played" }
								            ],
							                itemAggregates: ["numQtrs", "totPts", "totReb", "totAst", "totTP"],
							                aggregate: "sum"
							            }
						            ]]
					            }
				            ],
                            store: store,
                            query: { id: "3" },
                            queryOptions: { deep: true },
                            rowSelector: true
                        }, container);
                        dojo.addClass(g.domNode, "grid");
                        dojo.byId('sutContainer').appendChild(g.domNode);
                        g.startup();
                    }

                ]);
            //Execute D.O.H. in this remote file.
            doh.run();
        });
    </script>
</head>
<body class="soria">
    <!-- place to insert sut. -->
    <div id="sutContainer" style="width: 500px; height: 800px">
    </div>
    <div id="mouseOutArea" style="width: 500px; height: 100px">
        <br />
    </div>
</body>
</html>
