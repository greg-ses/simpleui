---
- hosts: all
  vars:
    app_name: device
    app_source_dir: "{{ rootfs_source_dir }}/usr/share/apache2/htdocs"
    target_dir: /usr/share/apache2/htdocs
  remote_user: "{{ lookup('env', 'REMOTE_WEB_USER') }}"
  tasks:
  - include_vars:
      file: commonvars.yml
  - set_fact:
  - name: Prep Local Staging Area
    local_action: file path={{ unit_config_source_dir }} state=absent
  - local_action: file path={{ unit_config_source_dir }} state=directory mode=0755
  - name: Prep BMS Target Staging Area
    file:
      path: "{{ bms_stage_dir }}"
      state: directory
      mode: 0755

  - name: Create UI archive for transfer
    local_action: command tar -cf /tmp/{{ app_name }}.tar -C {{ app_source_dir }}/ {{ app_name }}
  - name: Copy UI archive to target
    copy: src=/tmp/{{ app_name }}.tar dest={{ bms_stage_dir }}/{{ app_name }}.tar
    # unarchive: dest=/usr/share/apache2/htdocs remote_src=yes src=/home/root/module-staging-area/device.tar
