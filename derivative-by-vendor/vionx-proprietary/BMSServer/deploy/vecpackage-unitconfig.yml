---
# use flag --extra-vars "remupdate=true" to complete the distribution to all VECs.
# Without the flag set the packages are created and copied to the BMS server staging area only.
- hosts: all
  vars:
    app_name: vecpackage-unitconfig
  remote_user: "{{ lookup('env', 'REMOTE_WEB_USER') }}"
  tasks:
  - include_vars:
      file: commonvars.yml
  - name: Prep Local Staging Area
    local_action: file path={{ unit_config_source_dir }} state=absent
  - local_action: file path={{ unit_config_source_dir }} state=directory mode=0755
  - name: Prep BMS Target Staging Area
    file:
      path: "{{ bms_stage_dir }}"
      state: directory
      mode: 0755
  - name: Run Python Packaging Script
    local_action: command ./package_unitconfig.sh chdir=../../arm/setup
  - name: Copy Python Zip File To Target
    copy: src=/tmp/{{ python_zip_name }} dest={{ bms_stage_dir }}/{{ python_zip_name }}
