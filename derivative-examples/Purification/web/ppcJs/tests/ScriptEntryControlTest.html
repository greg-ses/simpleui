<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" encoding="utf-8">
<head>
    <title>ScriptEntryControlTest</title>
    <link rel="stylesheet" type="text/css" href="../../dojo-toolkit/dojo/resources/dojo.css" />
    <link rel="stylesheet" type="text/css" href="../../dojo-toolkit/dijit/themes/soria/soria.css" />
    <link rel="stylesheet" type="text/css" href="../control/scriptEntry/css/scriptEntry.css" />
    <script type="text/javascript">
        // djConfig must be set before any dojo scripts are loaded
        var djConfig = {
            isDebug: false,
            parseOnLoad: true,
            modulePaths: { 'ppcJs': '../../ppcJs' }
        };
    </script>
    <script type="text/javascript" src="../../dojo-toolkit/dojo/dojo.js"></script>
    <script type="text/javascript">
        dojo.provide('ppcJs.tests.ScriptEntryControlTestHTML');
        dojo.require('dojo.parser');
        dojo.require('doh.runner');
        dojo.require('dojo.robot');
        dojo.require('ppcJs.Enum');
        dojo.require('ppcJs.script.EntryEnum');
        dojo.require('ppcJs.control.ScriptEntry');
        dojo.require('ppcJs.control.scriptEntry.seDto');
        dojo.require('ppcJs.tests.ScriptTestUtilities');

        var perActionDelay = 600;
        var initialActionDelay = 2 * perActionDelay;    // to wait until after initial queued collapse on configure
        var perActionPause = 500;
        var assertPause = 2 * perActionPause;
        var testCaseTimeout = 50 * perActionDelay;

        dojo.addOnLoad(function () {
            doh.register('ppcJs.tests.ScriptEntryControlTest', [
            /**/
            {
            name: "ChangeSelectToParamUpdateAndGetBo",
            timeout: testCaseTimeout,

            setUp: function () {
                var sutContainer = dojo.byId('sutContainer');
                sutContainer.innerHTML = "";
            },

            runTest: function () {
                var d = new doh.Deferred();

                var newParam = 'newParam';
                var newValue = 'newValue';
                var uuid = 'a8e21a25-d040-11e1-9b23-0800200c9a66';
                var cmdType = ppcJs.script.EntryEnum.CommandType.Action;
                var selectName = 'COMMAND';
                var id0 = '1';
                var id1 = 'r1';
                var id2 = 'r2';
                var arg0 = new ppcJs.script.Arg(id0, selectName, 'charge', ppcJs.script.EntryEnum.ValueType.Select);
                var bo = new ppcJs.script.Entry(uuid, cmdType, [arg0]);

                sut = new ppcJs.control.ScriptEntry();
                sut.addSelect(id0, selectName, ['charge', 'strip', 'PARAM_UPDATE', 'extension2'], [null, null, 'param', 'extension2Ref']);
                sut.addString(id1, 'PSTR', 'param');
                sut.addString(id2, 'VALUE', 'param');
                sut.addString('r98', 'extension2Name', 'extension2Ref');
                sut.addString('r99', 'extension2Value', 'extension2Ref');
                sut.configure(bo);
                dojo.place(sut.domNode, "sutContainer");

                // select PARAM_UPDATE (select[2])
                dojo.robot.mouseMoveAt(dojo.byId('sutContainer'), perActionDelay, perActionPause);
                var selectNode = sut._idWidgetMap.item(id0).domNode;
                dojo.robot.mouseMoveAt(selectNode, perActionDelay, perActionPause);
                dojo.robot.mouseClick({ left: true }, perActionDelay);
                dojo.robot.keyPress(dojo.keys.DOWN_ARROW, perActionDelay);
                dojo.robot.keyPress(dojo.keys.DOWN_ARROW, perActionDelay);
                dojo.robot.keyPress(dojo.keys.ENTER, perActionDelay);

                // enter PSTR
                var pstrNode = sut._idWidgetMap.item(id1).domNode;
                dojo.robot.mouseMoveAt(pstrNode, perActionDelay, perActionPause);
                dojo.robot.mouseClick({ left: true }, perActionDelay);
                dojo.robot.typeKeys(newParam, perActionDelay, perActionPause);
                dojo.robot.keyPress(dojo.keys.ENTER, perActionDelay);

                // enter VALUE
                var valueNode = sut._idWidgetMap.item(id2).domNode;
                dojo.robot.mouseMoveAt(valueNode, perActionDelay, perActionPause);
                dojo.robot.mouseClick({ left: true }, perActionDelay);
                dojo.robot.typeKeys(newValue, perActionDelay, perActionPause);
                dojo.robot.keyPress(dojo.keys.ENTER, perActionDelay);

                dojo.robot.sequence(d.getTestCallback(function () {
                    var result = sut.getValue();

                    // add param items to ref BO
                    var arg1 = new ppcJs.script.Arg('r1', 'PSTR', newParam, ppcJs.script.EntryEnum.ValueType.String);
                    bo.args.push(arg1);
                    var arg2 = new ppcJs.script.Arg('r2', 'VALUE', newValue, ppcJs.script.EntryEnum.ValueType.String);
                    bo.args.push(arg2);

                    var paramNameValid = (bo.args[1].value === result.args[1].value);
                    var paramValueValid = (bo.args[2].value === result.args[2].value);
                    doh.assertTrue((paramNameValid && paramValueValid), 'incorrect PSTR/VALUE retrieved from BO');
                }), assertPause);

                return d;
            }
        },

            {
                name: "CreateActionConfigParamSelectStripAndGetBo",
                timeout: testCaseTimeout,

                setUp: function () {
                    var sutContainer = dojo.byId('sutContainer');
                    sutContainer.innerHTML = "";
                },

                runTest: function () {
                    var d = new doh.Deferred();

                    var uuid = 'a8e21a25-d040-11e1-9b23-0800200c9a66';
                    var cmdType = ppcJs.script.EntryEnum.CommandType.Action;
                    var selectName = 'COMMAND';
                    var id0 = '1';
                    var id1 = 'r1';
                    var id2 = 'r2';
                    var arg0 = new ppcJs.script.Arg(id0, selectName, 'PARAM_UPDATE', ppcJs.script.EntryEnum.ValueType.Select);
                    var arg1 = new ppcJs.script.Arg(id1, 'PSTR', 'oldParam', ppcJs.script.EntryEnum.ValueType.String);
                    var arg2 = new ppcJs.script.Arg(id2, 'VALUE', 'oldValue', ppcJs.script.EntryEnum.ValueType.String);
                    var bo = new ppcJs.script.Entry(uuid, cmdType, [arg0, arg1, arg2]);

                    sut = new ppcJs.control.ScriptEntry();
                    sut.addSelect(id0, selectName, ['charge', 'strip', 'PARAM_UPDATE', 'extension2'], [null, null, 'param', 'extension2Ref']);
                    sut.addString(id1, 'PSTR', 'param');
                    sut.addString(id2, 'VALUE', 'param');
                    sut.addString('r98', 'extension2Name', 'extension2Ref');
                    sut.addString('r99', 'extension2Value', 'extension2Ref');

                    sut.configure(bo);
                    dojo.place(sut.domNode, "sutContainer");

                    dojo.robot.mouseMoveAt(dojo.byId('sutContainer'), initialActionDelay, perActionPause);

                    // select strip (select[1])
                    var selectNode = sut._idWidgetMap.item(id0).domNode;
                    dojo.robot.mouseMoveAt(selectNode, perActionPause);
                    dojo.robot.mouseClick({ left: true }, perActionPause);
                    dojo.robot.keyPress(dojo.keys.UP_ARROW, perActionPause);
                    dojo.robot.keyPress(dojo.keys.ENTER, perActionPause);

                    dojo.robot.sequence(d.getTestCallback(function () {
                        var result = sut.getValue();

                        // add param items to ref BO
                        var correctNumArgs = (result.args.length == 1);
                        var correctArg0 = ((result.args[0].name == 'COMMAND') && (result.args[0].value == 'strip') && (result.args[0].valueType == ppcJs.script.EntryEnum.ValueType.Select));

                        doh.assertTrue((correctNumArgs && correctArg0), 'incorrect args retrieved from BO');
                    }), assertPause);

                    return d;
                }
            },

            function testCreateLabelConfigAndGetBo(t) {
                var uuid = 'a8e21a25-d040-11e1-9b23-0800200c9a66';
                var cmdType = ppcJs.script.EntryEnum.CommandType.Label;
                var id0 = '1';
                var arg0 = new ppcJs.script.Arg(id0, 'label', 'AA', ppcJs.script.EntryEnum.ValueType.String);
                var bo = new ppcJs.script.Entry(uuid, cmdType, [arg0]);

                sut = new ppcJs.control.ScriptEntry();
                sut.addString(id0, 'label');
                var handler = dojo.connect(sut, 'onValueChange', function () {
                    t.assertTrue(false, 'onValueChange thrown on configure');
                }, this);

                sut.configure(bo);
                dojo.place(sut.domNode, "sutContainer");

                var result = sut.getValue();

                ppcJs.tests.ScriptTestUtilities.assertBoEqual(t, bo, result);
            },

            {
                name: "UpdateLabelThrowsEventAndGetBo",
                timeout: testCaseTimeout,

                setUp: function () {
                    var sutContainer = dojo.byId('sutContainer');
                    sutContainer.innerHTML = "";
                },

                runTest: function () {
                    var d = new doh.Deferred();

                    var uuid = 'a8e21a25-d040-11e1-9b23-0800200c9a66';
                    var cmdType = ppcJs.script.EntryEnum.CommandType.Label;
                    var id0 = '1';
                    var textBoxName = 'label';
                    var arg0 = new ppcJs.script.Arg(id0, textBoxName, '', ppcJs.script.EntryEnum.ValueType.String);
                    var bo = new ppcJs.script.Entry(uuid, cmdType, [arg0]);
                    var valueChanged = false;

                    sut = new ppcJs.control.ScriptEntry();
                    var handler = dojo.connect(sut, 'onValueChange', function () {
                        valueChanged = true;
                    }, this);

                    sut.addString(id0, textBoxName);
                    sut.configure(bo);
                    dojo.place(sut.domNode, 'sutContainer');

                    // expand control
                    //var buttonNode = sut.collapseToggle.domNode;
                    //dojo.robot.mouseMoveAt(buttonNode, initialActionDelay, perActionPause);
                    //dojo.robot.mouseClick({ left: true }, perActionDelay);

                    // enter label
                    var newLabel = 'BB';
                    var textBoxNode = sut._idWidgetMap.item(id0).domNode;
                    dojo.robot.mouseMoveAt(textBoxNode, perActionDelay, perActionPause);
                    dojo.robot.mouseClick({ left: true }, perActionDelay);
                    dojo.robot.typeKeys(newLabel, perActionDelay, perActionPause);

                    // collapse to fire onValueChange event
                    var buttonNode = sut.collapseToggle.domNode;
                    dojo.robot.mouseMoveAt(buttonNode, perActionDelay, perActionPause);
                    dojo.robot.mouseClick({ left: true }, perActionDelay);

                    dojo.robot.sequence(d.getTestCallback(function () {
                        var result = sut.getValue();
                        var resultLabel = result.args[0].value;
                        doh.assertTrue(valueChanged && (resultLabel === newLabel), 'no event or incorrect label retrieved from BO:' + resultLabel);
                    }), assertPause);

                    return d;
                }
            },

            {
                name: "UpdateLabelWithEventArgAfterOnSelectThrown",
                timeout: testCaseTimeout,

                setUp: function () {
                    var sutContainer = dojo.byId('sutContainer');
                    sutContainer.innerHTML = "";
                },

                runTest: function () {
                    var d = new doh.Deferred();

                    var uuid = 'a8e21a25-d040-11e1-9b23-0800200c9a66';
                    var cmdType = ppcJs.script.EntryEnum.CommandType.Label;
                    var id0 = '1';
                    var textBoxName = 'label';
                    var arg0 = new ppcJs.script.Arg(id0, textBoxName, '', ppcJs.script.EntryEnum.ValueType.String);
                    var bo = new ppcJs.script.Entry(uuid, cmdType, [arg0]);
                    var resultEventType = null;
                    var resultRefToSelf = null;

                    sut = new ppcJs.control.ScriptEntry();
                    var handler = dojo.connect(sut, 'onSelectWidget', function (eventType, refToSelf) {
                        resultEventType = eventType;
                        resultRefToSelf = refToSelf
                    }, this);

                    sut.addString(id0, textBoxName, null, ppcJs.script.EntryEnum.EventArgType.DataFile);
                    sut.configure(bo);
                    dojo.place(sut.domNode, 'sutContainer');

                    // click on  label
                    var newLabel = 'BB';
                    var textBoxNode = sut._idWidgetMap.item(id0).domNode;
                    dojo.robot.mouseMoveAt(textBoxNode, perActionDelay, perActionPause);
                    dojo.robot.mouseClick({ left: true }, perActionDelay);

                    dojo.robot.sequence(d.getTestCallback(function () {
                        // verify event args
                        doh.assertEqual(sut, resultRefToSelf, 'incorrect refToSelf');
                        doh.assertEqual(ppcJs.script.EntryEnum.EventArgType.DataFile, resultEventType, 'incorrect event type');

                        // verify update
                        var refLabel = 'ref label';
                        sut.update(refLabel);
                        var bo = sut.getValue();
                        doh.assertEqual(refLabel, bo.args[0].value, 'incorrect updated label value');
                    }), assertPause);

                    return d;
                }
            },

            function testCreateGoToConfigAndGetBo(t) {
                var uuid = 'a8e21a25-d040-11e1-9b23-0800200c9a66';
                var cmdType = ppcJs.script.EntryEnum.CommandType.GoTo;
                var id0 = '1';
                var id1 = '2';
                var arg0 = new ppcJs.script.Arg(id0, 'label', 'AA', ppcJs.script.EntryEnum.ValueType.String);
                var arg1 = new ppcJs.script.Arg(id1, 'count', 1, ppcJs.script.EntryEnum.ValueType.Int);
                var bo = new ppcJs.script.Entry(uuid, cmdType, [arg0, arg1]);

                sut = new ppcJs.control.ScriptEntry();
                sut.addString(id0, 'label');
                sut.addInt(id1, 'count', 0, 10);
                sut.configure(bo);
                sut.collapse();
                dojo.place(sut.domNode, "sutContainer");

                var result = sut.getValue();

                ppcJs.tests.ScriptTestUtilities.assertBoEqual(t, bo, result);
            },
        /*
        {
        name: "CreateDefaultActionSelectFloatExtensionAndGetBo",
        timeout: 20 * testCaseTimeout,

        setUp: function () {
        var sutContainer = dojo.byId('sutContainer');
        sutContainer.innerHTML = "";
        },

        runTest: function () {
        var d = new doh.Deferred();
        var floatName = 'float param';

        var uuid = 'a8e21a25-d040-11e1-9b23-0800200c9a66';
        var cmdType = ppcJs.script.EntryEnum.CommandType.Action;
        var id0 = '1';
        var selectName = 'COMMAND';
        var arg0 = new ppcJs.script.Arg(id0, selectName, 'charge', ppcJs.script.EntryEnum.ValueType.Select);

        var bo = new ppcJs.script.Entry(uuid, cmdType, [arg0]);

        sut = new ppcJs.control.ScriptEntry();
        sut.addSelect(id0, selectName, ['charge', 'strip', floatName], [null, null, 'float']);
        sut.addFloat('r99', 'VALUE', null, null, 'float');

        sut.configure(bo);
        dojo.place(sut.domNode, "sutContainer");

        // expand control
        //var buttonNode = sut.collapseToggle.domNode;
        //dojo.robot.mouseMoveAt(buttonNode, initialActionDelay, perActionPause);
        //dojo.robot.mouseClick({ left: true }, perActionDelay);

        // select float param (select[2])
        var selectNode = sut._idWidgetMap.item(id0).domNode;
        dojo.robot.mouseMoveAt(selectNode, perActionDelay, perActionPause);
        dojo.robot.mouseClick({ left: true }, perActionDelay);
        dojo.robot.keyPress(dojo.keys.DOWN_ARROW, perActionDelay);
        dojo.robot.keyPress(dojo.keys.DOWN_ARROW, perActionDelay);
        dojo.robot.keyPress(dojo.keys.ENTER, perActionDelay);


        dojo.robot.sequence(function () {
        var result = sut.getValue();

        // add param items to ref BO
        var correctNumArgs = (result.args.length == 2);
        var correctArg0 = ((result.args[0].name == selectName) && (result.args[0].value == floatName) && (result.args[0].valueType == ppcJs.script.EntryEnum.ValueType.Select));
        var correctArg1 = ((result.args[1].name == 'VALUE') && (result.args[1].value == 0) && (result.args[1].valueType == ppcJs.script.EntryEnum.ValueType.Float));
        if (correctNumArgs && correctArg0 && correctArg1) {
        d.callback(true);
        }
        else {
        d.errback(new Error('incorrect args retrieved from BO'));
        }
        }, assertPause);

        return d;
        }
        },
        */
                    function testCreateActionConfigStripAndGetBo(t) {
                        var uuid = 'a8e21a25-d040-11e1-9b23-0800200c9a66';
                        var cmdType = ppcJs.script.EntryEnum.CommandType.Action;
                        var id0 = '1';
                        var arg0 = new ppcJs.script.Arg(id0, 'COMMAND', 'strip', ppcJs.script.EntryEnum.ValueType.Select);
                        var bo = new ppcJs.script.Entry(uuid, cmdType, [arg0]);

                        sut = new ppcJs.control.ScriptEntry();
                        //sut.addTimeSpan('time');
                        sut.addSelect(id0, 'COMMAND', ['charge', 'strip', 'PARAM_UPDATE', 'extension2'], [null, null, 'param', 'extension2Ref']);
                        sut.addString('r1', 'PSTR', 'param');
                        sut.addString('r2', 'VALUE', 'param');
                        sut.addString('r91', 'extension2Name', 'extension2Ref');
                        sut.addString('r92', 'extension2Value', 'extension2Ref');

                        sut.configure(bo);
                        sut.collapse();
                        dojo.place(sut.domNode, "sutContainer");

                        var result = sut.getValue();

                        ppcJs.tests.ScriptTestUtilities.assertBoEqual(t, bo, result);
                    },

                    function testCreateActionConfigParamAndGetBo(t) {
                        var uuid = 'a8e21a25-d040-11e1-9b23-0800200c9a66';
                        var cmdType = ppcJs.script.EntryEnum.CommandType.Action;
                        // 1 hr, 1 min, 1 sec = 3661 sec
                        //var arg0 = new ppcJs.script.Arg('time', 3661, ppcJs.script.EntryEnum.ValueType.TimeSpan);
                        var id0 = '1';
                        var id1 = 'r1';
                        var id2 = 'r2';
                        var arg1 = new ppcJs.script.Arg('1', 'COMMAND', 'PARAM_UPDATE', ppcJs.script.EntryEnum.ValueType.Select);
                        var arg2 = new ppcJs.script.Arg('r1', 'PSTR', 'oldParam', ppcJs.script.EntryEnum.ValueType.String);
                        var arg3 = new ppcJs.script.Arg('r2', 'VALUE', 'oldValue', ppcJs.script.EntryEnum.ValueType.String);
                        var bo = new ppcJs.script.Entry(uuid, cmdType, [arg1, arg2, arg3]);

                        sut = new ppcJs.control.ScriptEntry();

                        sut.addSelect(id0, 'COMMAND', ['charge', 'strip', 'PARAM_UPDATE', 'extension2'], [null, null, 'param', 'extension2Ref']);
                        sut.addString(id1, 'PSTR', 'param');
                        sut.addString(id2, 'VALUE', 'param');
                        sut.addString('r98', 'extension2Name', 'extension2Ref');
                        sut.addString('r99', 'extension2Value', 'extension2Ref');

                        sut.configure(bo);
                        dojo.place(sut.domNode, "sutContainer");

                        var result = sut.getValue();

                        ppcJs.tests.ScriptTestUtilities.assertBoEqual(t, bo, result);
                    },

                    function testCreateWaitLessThanConfigAndGetBo(t) {
                        sut = new ppcJs.control.ScriptEntry();
                        sut.addSelect('1', 'units', ['Avg_Batt_AH']);
                        sut.addFloat('2', 'threshold', 0, 100000);

                        var bo = ppcJs.tests.ScriptTestUtilities.getLessThanWaitBo();
                        sut.configure(bo);
                        //sut.collapse();
                        dojo.place(sut.domNode, "sutContainer");

                        var result = sut.getValue();

                        ppcJs.tests.ScriptTestUtilities.assertBoEqual(t, bo, result);
                    },

                    function testCreateWaitGreaterThanConfigAndGetBo(t) {
                        sut = new ppcJs.control.ScriptEntry();
                        sut.addSelect('1', 'units', ['Avg_Batt_AH']);
                        sut.addFloat('2', 'threshold', 0, 100000);

                        var bo = ppcJs.tests.ScriptTestUtilities.getGreaterThanWaitBo();
                        sut.configure(bo);
                        //sut.collapse();
                        dojo.place(sut.domNode, "sutContainer");

                        var result = sut.getValue();

                        ppcJs.tests.ScriptTestUtilities.assertBoEqual(t, bo, result);
                    },

                    function testCreateWaitDateTimeConfigAndGetBo(t) {
                        sut = new ppcJs.control.ScriptEntry();
                        sut.addTimeStamp('1', 'time');

                        var bo = ppcJs.tests.ScriptTestUtilities.getDateTimeWaitBo();
                        sut.configure(bo);
                        //sut.collapse();
                        dojo.place(sut.domNode, "sutContainer");

                        var result = sut.getValue();

                        ppcJs.tests.ScriptTestUtilities.assertBoEqual(t, bo, result);
                    },

                    function testCreateWaitTimeOfDayConfigAndGetBo(t) {
                        sut = new ppcJs.control.ScriptEntry();
                        sut.addTimeOfDay('1', 'time');

                        var bo = ppcJs.tests.ScriptTestUtilities.getTimeOfDayWaitBo();
                        sut.configure(bo);
                        //sut.collapse();
                        dojo.place(sut.domNode, "sutContainer");

                        var result = sut.getValue();

                        ppcJs.tests.ScriptTestUtilities.assertBoEqual(t, bo, result);
                    },

                    function testCreateWaitStateConfigAndGetBo(t) {
                        sut = new ppcJs.control.ScriptEntry();
                        sut.addSelect('1', 'mode', ['Charge', 'Discharge', 'Float', 'Standby', 'UPS']);
                        sut.addSelect('2', 'submode', ['', 'Strip Complete']);

                        var bo = ppcJs.tests.ScriptTestUtilities.getStateWaitBo();
                        sut.configure(bo);
                        //sut.collapse();
                        dojo.place(sut.domNode, "sutContainer");

                        var result = sut.getValue();

                        ppcJs.tests.ScriptTestUtilities.assertBoEqual(t, bo, result);
                    },

                    function testCreateCustomActionDefaultConfig(t) {
                        sut = new ppcJs.control.ScriptEntry();
                        var refKeyword = 'customCmd';
                        var cmdNameWidgetName = 'name';
                        var cmdValueWidgetName = 'value';
                        var id0 = '1';
                        sut.addSubstitution(id0, '*', refKeyword);
                        sut.addString('r4', cmdNameWidgetName, refKeyword);
                        sut.addString('r5', cmdValueWidgetName, refKeyword);

                        var uuid = 'a8e21a26-d040-11e1-9b23-0800200c9a66';
                        var arg0 = new ppcJs.script.Arg(id0, '', '', ppcJs.script.EntryEnum.ValueType.String);
                        var bo = new ppcJs.script.Entry(uuid, ppcJs.script.EntryEnum.CommandType.CustomAction, [arg0]);

                        sut.configure(bo);
                        //sut.collapse();
                        dojo.place(sut.domNode, "sutContainer");

                        var result = sut.getValue();

                        ppcJs.tests.ScriptTestUtilities.assertBoEqual(t, bo, result);
                    },

                    function testCreateCustomActionConfigVerifyWidgetValuesAndGetBo(t) {
                        sut = new ppcJs.control.ScriptEntry();
                        var refKeyword = 'customCmd';
                        var cmdNameWidgetName = 'name';
                        var cmdValueWidgetName = 'value';
                        var id1 = 'r4';
                        var id2 = 'r5';
                        sut.addSubstitution('1', '*', refKeyword);
                        sut.addString(id1, cmdNameWidgetName, refKeyword);
                        sut.addString(id2, cmdValueWidgetName, refKeyword);

                        var bo = ppcJs.tests.ScriptTestUtilities.getCustomActionBo();
                        sut.configure(bo);
                        //sut.collapse();
                        dojo.place(sut.domNode, "sutContainer");
                        var result = sut.getValue();

                        ppcJs.tests.ScriptTestUtilities.assertBoEqual(t, bo, result);
                        /*
                        // verify ref widgets not hidden, have correct values
                        var nameWidget = sut._idWidgetMap.item(id1);
                        t.assertEqual('customAction1', nameWidget.get('value'), 'incorrect nameWidget value');
                        var visibilityStyle = dojo.getStyle(nameWidget.domNode, 'visibility');
                        t.assertEqual('visible', visibilityStyle, 'nameWidget not visible');

                        var valueWidget = sut._idWidgetMap.item(id2);
                        t.assertEqual('customValue1', valueWidget.get('value'), 'incorrect valueWidget value');
                        visibilityStyle = dojo.getStyle(valueWidget.domNode, 'visibility');
                        t.assertEqual('visible', visibilityStyle, 'valueWidget not visible');
                        */
                        t.assertTrue(true);
                    },

                    function testVerifyCollapseHidesExtensionWidgets(t) {
                        var uuid = 'a8e21a25-d040-11e1-9b23-0800200c9a66';
                        var cmdType = ppcJs.script.EntryEnum.CommandType.Action;
                        var id0 = '1';
                        var id1 = 'r1';
                        var id2 = 'r2';
                        var arg0 = new ppcJs.script.Arg(id0, 'COMMAND', 'PARAM_UPDATE', ppcJs.script.EntryEnum.ValueType.Select);
                        var arg1 = new ppcJs.script.Arg(id1, 'PSTR', 'oldParam', ppcJs.script.EntryEnum.ValueType.String);
                        var arg2 = new ppcJs.script.Arg(id2, 'VALUE', 'oldValue', ppcJs.script.EntryEnum.ValueType.String);
                        var bo = new ppcJs.script.Entry(uuid, cmdType, [arg0, arg1, arg2]);

                        sut = new ppcJs.control.ScriptEntry();
                        sut.addSelect(id0, 'COMMAND', ['charge', 'strip', 'PARAM_UPDATE', 'extension2'], [null, null, 'param', 'extension2Ref']);
                        sut.addString(id1, 'PSTR', 'param');
                        sut.addString(id2, 'VALUE', 'param');
                        sut.addString('r98', 'extension2Name', 'extension2Ref');
                        sut.addString('r99', 'extension2Value', 'extension2Ref');

                        sut.configure(bo);
                        dojo.place(sut.domNode, "sutContainer");
                        sut.collapse();
                        /*
                        sut._idWidgetMap.forEach(function (widgetMapEntry) {
                        if (!dojo.isString(widgetMapEntry.value)) {
                        var visibilityStyle = dojo.getStyle(widgetMapEntry.value.domNode, 'visibility');
                        t.assertEqual('hidden', visibilityStyle);
                        }
                        });
                        */
                        t.assertTrue(true);
                    }
        /*
        {
        name: "VerifyExpandsShowsOnlySelectedExtensionWidgets",
        timeout: testCaseTimeout,

        setUp: function () {
        },

        runTest: function () {
        var uuid = 'a8e21a25-d040-11e1-9b23-0800200c9a66';
        var cmdType = ppcJs.script.EntryEnum.CommandType.Action;
        var id0 = '1';
        var id1 = 'r1';
        var id2 = 'r2';
        var arg0 = new ppcJs.script.Arg(id0, 'COMMAND', 'PARAM_UPDATE', ppcJs.script.EntryEnum.ValueType.Select);
        var arg1 = new ppcJs.script.Arg(id1, 'PSTR', 'oldParam', ppcJs.script.EntryEnum.ValueType.String);
        var arg2 = new ppcJs.script.Arg(id2, 'VALUE', 'oldValue', ppcJs.script.EntryEnum.ValueType.String);
        var bo = new ppcJs.script.Entry(uuid, cmdType, [arg0, arg1, arg2]);

        var selectedRef = 'param';
        var unselectedRef = 'extension2Ref';

        sut = new ppcJs.control.ScriptEntry();
        sut.addSelect(id0, 'COMMAND', ['charge', 'strip', 'PARAM_UPDATE', 'extension2'], [null, null, selectedRef, unselectedRef]);
        sut.addString(id1, 'PSTR', selectedRef);
        sut.addString(id2, 'VALUE', selectedRef);
        sut.addString('r98', 'extension2Name', unselectedRef);
        sut.addString('r99', 'extension2Value', unselectedRef);

        sut.configure(bo);
        dojo.place(sut.domNode, "sutContainer");
        sut.collapse();
        sut.expand();

        var deferred = new doh.Deferred();
        setTimeout(deferred.getTestCallback(function () {
        // verify selected PSTR/VALUE widgets displayed, unselected extension2Name/extension2Value hidden
        var selectedrefWidgets = sut._refWidgetsMap.item(selectedRef);
        dojo.forEach(selectedrefWidgets, function (widgetMapEntry) {
        if (!dojo.isString(widgetMapEntry)) {
        var visibilityStyle = dojo.getStyle(widgetMapEntry.domNode, 'visibility');
        doh.assertEqual('visible', visibilityStyle, 'selected ref widgets not visible');
        }
        });

        var unselectedRefWidgets = sut._refWidgetsMap.item(unselectedRef);
        dojo.forEach(unselectedRefWidgets, function (widgetMapEntry) {
        if (!dojo.isString(widgetMapEntry)) {
        var visibilityStyle = dojo.getStyle(widgetMapEntry.domNode, 'visibility');
        doh.assertEqual('hidden', visibilityStyle, 'unselected ref widgets not hidden');
        }
        });
        }, this), 1000);

        return deferred;
        }
        },

        function testVerifyConfigureViewModeHidesExtensionWidgets(t) {
        var uuid = 'a8e21a25-d040-11e1-9b23-0800200c9a66';
        var cmdType = ppcJs.script.EntryEnum.CommandType.Action;
        var id0 = '1';
        var id1 = 'r1';
        var id2 = 'r2';
        var arg0 = new ppcJs.script.Arg(id0, 'COMMAND', 'PARAM_UPDATE', ppcJs.script.EntryEnum.ValueType.Select);
        var arg1 = new ppcJs.script.Arg(id1, 'PSTR', 'oldParam', ppcJs.script.EntryEnum.ValueType.String);
        var arg2 = new ppcJs.script.Arg(id2, 'VALUE', 'oldValue', ppcJs.script.EntryEnum.ValueType.String);
        var bo = new ppcJs.script.Entry(uuid, cmdType, [arg0, arg1, arg2]);

        var selectedRef = 'param';
        var unselectedRef = 'extension2Ref';

        sut = new ppcJs.control.ScriptEntry();
        sut.addSelect(id0, 'COMMAND', ['charge', 'strip', 'PARAM_UPDATE', 'extension2'], [null, null, selectedRef, unselectedRef]);
        sut.addString(id1, 'PSTR', selectedRef);
        sut.addString(id2, 'VALUE', selectedRef);
        sut.addString('r98', 'extension2Name', unselectedRef);
        sut.addString('r99', 'extension2Value', unselectedRef);

        sut.configure(bo);
        dojo.place(sut.domNode, "sutContainer");

        sut.setViewState(ppcJs.Enum.ViewState.View);
        }
        */

            ]);
        //Execute D.O.H. in this remote file.
        doh.run();
    });
    </script>
</head>
<body class="soria">
    <!-- place to insert sut. -->
    <div id="sutContainer" style="width: 800px; height: 400px">
    </div>
    <div id="mouseOutArea" style="width: 300px; height: 100px">
        <br />
    </div>
</body>
</html>
